System.register(["jimu-core","jimu-arcgis","jimu-ui","esri/layers/GraphicsLayer","esri/Graphic","esri/geometry/Point","esri/geometry/Polyline","esri/geometry/Polygon","esri/geometry/SpatialReference","esri/Color","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleFillSymbol","esri/geometry/projection"],(function(e,t){var i={},n={},o={},r={},s={},l={},a={},d={},u={},c={},p={},f={},v={},m={};return{setters:[function(e){i.React=e.React,i.css=e.css,i.getAppStore=e.getAppStore,i.jsx=e.jsx},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent},function(e){o.Alert=e.Alert,o.Button=e.Button,o.Checkbox=e.Checkbox,o.Label=e.Label,o.Switch=e.Switch,o.TextInput=e.TextInput},function(e){r.default=e.default},function(e){s.default=e.default},function(e){l.default=e.default},function(e){a.default=e.default},function(e){d.default=e.default},function(e){u.default=e.default},function(e){c.default=e.default},function(e){p.default=e.default},function(e){f.default=e.default},function(e){v.default=e.default},function(e){m.getTransformation=e.getTransformation,m.load=e.load,m.project=e.project}],execute:function(){e((()=>{var e,t,g={26:e=>{"use strict";e.exports=v},196:e=>{"use strict";e.exports=a},422:e=>{"use strict";e.exports=l},1526:e=>{"use strict";e.exports=d},2089:e=>{"use strict";e.exports=s},2686:e=>{"use strict";e.exports=n},3205:e=>{"use strict";e.exports=u},4321:e=>{"use strict";e.exports=o},6333:e=>{"use strict";e.exports=m},7417:e=>{"use strict";e.exports=f},7442:e=>{"use strict";e.exports=c},8897:e=>{"use strict";e.exports=p},9244:e=>{"use strict";e.exports=i},9620:e=>{"use strict";e.exports=r}},y={};function x(e){var t=y[e];if(void 0!==t)return t.exports;var i=y[e]={exports:{}};return g[e].call(i.exports,i,i.exports,x),i.exports}x.m=g,x.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return x.d(t,{a:t}),t},x.d=(e,t)=>{for(var i in t)x.o(t,i)&&!x.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},x.f={},x.e=e=>Promise.all(Object.keys(x.f).reduce(((t,i)=>(x.f[i](e,t),t)),[])),x.u=e=>{if("vendors-node_modules_dxf-parser_dist_index_js"===e)return"widgets/chunks/vendors-node_modules_dxf-parser_dist_index_js.js"},x.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="exb-client:",x.l=(i,n,o,r)=>{if(e[i])e[i].push(n);else{var s,l;if(void 0!==o)for(var a=document.getElementsByTagName("script"),d=0;d<a.length;d++){var u=a[d];if(u.getAttribute("src")==i||u.getAttribute("data-webpack")==t+o){s=u;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,x.nc&&s.setAttribute("nonce",x.nc),s.setAttribute("data-webpack",t+o),s.src=i),e[i]=[n];var c=(t,n)=>{s.onerror=s.onload=null,clearTimeout(p);var o=e[i];if(delete e[i],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach((e=>e(n))),t)return t(n)},p=setTimeout(c.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=c.bind(null,s.onerror),s.onload=c.bind(null,s.onload),l&&document.head.appendChild(s)}},x.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},x.p="",(()=>{var e={"widgets/DXF Uploader/dist/runtime/widget":0};x.f.j=(t,i)=>{var n=x.o(e,t)?e[t]:void 0;if(0!==n)if(n)i.push(n[2]);else{var o=new Promise(((i,o)=>n=e[t]=[i,o]));i.push(n[2]=o);var r=x.p+x.u(t),s=new Error;x.l(r,(i=>{if(x.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var o=i&&("load"===i.type?"missing":i.type),r=i&&i.target&&i.target.src;s.message="Loading chunk "+t+" failed.\n("+o+": "+r+")",s.name="ChunkLoadError",s.type=o,s.request=r,n[1](s)}}),"chunk-"+t,t)}};var t=(t,i)=>{var n,o,[r,s,l]=i,a=0;if(r.some((t=>0!==e[t]))){for(n in s)x.o(s,n)&&(x.m[n]=s[n]);if(l)l(x)}for(t&&t(i);a<r.length;a++)o=r[a],x.o(e,o)&&e[o]&&e[o][0](),e[o]=0},i=self.webpackChunkexb_client=self.webpackChunkexb_client||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var h={};return x.p=window.jimuConfig.baseUrl,(()=>{"use strict";x.r(h),x.d(h,{__set_webpack_public_path__:()=>j,default:()=>g});var e=x(9244),t=x(2686),i=x(4321),n=x(9620),o=x(2089),r=x(422),s=x(196),l=x(1526),a=x(3205),d=x(7442),u=x(8897),c=x(7417),p=x(26),f=x(6333),v=function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function s(e){try{a(n.next(e))}catch(e){r(e)}}function l(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,l)}a((n=n.apply(e,t||[])).next())}))};const m=[[0,122,255],[255,99,72],[52,199,89],[255,159,10],[175,82,222],[90,200,250],[255,45,85],[88,86,214]].map((e=>new d.default([...e,1])));function g(r){var s,l,g;const[h,b]=e.React.useState(null),[w,j]=e.React.useState("2039"),[k,C]=e.React.useState(!0),[S,_]=e.React.useState(null),[M,R]=e.React.useState(!1),[A,I]=e.React.useState([]),P=e.React.useRef(null),T=null===(s=r.useMapWidgetIds)||void 0===s?void 0:s[0];let L;try{const t=null===(l=(0,e.getAppStore)())||void 0===l?void 0:l.getState(),i=(null===(g=null==t?void 0:t.appStateInBuilder)||void 0===g?void 0:g.appConfig)||(null==t?void 0:t.appConfig),n=(null==i?void 0:i.widgets)||{},o=Object.keys(n).filter((e=>{var t,i,o;return"map"===(null===(i=null===(t=n[e])||void 0===t?void 0:t.manifest)||void 0===i?void 0:i.name)||"MAP"===(null===(o=n[e])||void 0===o?void 0:o.type)}));1===o.length&&(L=o[0])}catch(e){}const D=T||L,N=e.React.useCallback((e=>v(this,void 0,void 0,(function*(){try{if(!(null==e?void 0:e.view))return void b(null);yield e.view.when(),b(e)}catch(e){}}))),[]);e.React.useEffect((()=>()=>{try{A.forEach((e=>{var t,i;return null===(i=null===(t=null==h?void 0:h.view)||void 0===t?void 0:t.map)||void 0===i?void 0:i.remove(e.layer)}))}catch(e){}}),[h]);const B={card:e.css`
      width:100%;
      border-radius:14px;
      box-shadow:0 4px 12px rgba(0,0,0,.15);
      background:rgba(255,255,255,.95);
      backdrop-filter:blur(6px);
      padding:14px;
      border:1px solid #d1d5db;
    `,row:e.css`display:flex;gap:10px;align-items:center;flex-wrap:wrap;`,drop:t=>e.css`
      border:2px dashed ${t?"#2563eb":"#d1d5db"};
      border-radius:10px; padding:16px;
      background:${t?"rgba(37,99,235,0.05)":"#f9fafb"};
      cursor:pointer; text-align:center;
      transition:all .15s;
      &:hover{border-color:#2563eb;}
    `,list:e.css`margin-top:10px;display:flex;flex-direction:column;gap:6px;`,item:e.css`
      display:flex; flex-wrap:wrap; gap:8px;
      align-items:center; justify-content:space-between;
      border:1px solid #e5e7eb; border-radius:10px; padding:8px 10px; background:#fff;
    `,left:e.css`
      display:flex; align-items:center; gap:8px; min-width:0; flex:1 1 260px;
      .name { font-weight:600; font-size:12px; line-height:16px; word-break:break-all; }
      .meta { font-size:11px; color:#64748b; }
    `,right:e.css`display:flex; align-items:center; gap:8px; flex:0 0 auto;`,dot:t=>e.css`width:12px;height:12px;border-radius:50%;background:${t.toCss(!0)};border:1px solid #9ca3af;`},E=e=>{const t=e.filter(Boolean);return t.length?t.reduce(((e,t)=>e?e.union(t):t),null):null},F=(e,t)=>v(this,void 0,void 0,(function*(){var i;if(!D)return _({type:"warning",msg:"Please select a Map in the widget settings."}),null;if(!(null===(i=null==h?void 0:h.view)||void 0===i?void 0:i.ready))return _({type:"error",msg:"Map is not ready yet."}),null;yield f.load();const r=e.name.toLowerCase();if(r.endsWith(".dwg"))return _({type:"warning",msg:"DWG not supported. Convert to ASCII DXF."}),null;if(!r.endsWith(".dxf"))return _({type:"error",msg:"Only .dxf is supported."}),null;const s=yield e.text(),l=yield x.e("vendors-node_modules_dxf-parser_dist_index_js").then(x.bind(x,2879)),v=(new(l.default||l)).parseSync(s),m=parseInt(w||"2039",10),g=new a.default({wkid:isNaN(m)?2039:m}),b=h.view.spatialReference,j=(C=t,{line:new u.default({color:C,width:1.5}),point:new c.default({size:6,color:C,outline:new u.default({color:new d.default([255,255,255,1]),width:.5})}),fill:new p.default({color:new d.default([C.r,C.g,C.b,.15]),outline:new u.default({color:C,width:1.2})})});var C;const S=[];for(const e of v.entities||[]){const t=y(e,g,k,j);Array.isArray(t)?S.push(...t):t&&S.push(t)}const M=g.wkid!==b.wkid&&f.getTransformation(g,b)||null,R=[];for(const e of S){const t=g.wkid===b.wkid?e.geometry:f.project(e.geometry,b,M);t&&R.push(new o.default({geometry:t,symbol:e.symbol,attributes:e.attributes}))}let A=0,I=0,P=0;R.forEach((e=>{var t;const i=null===(t=e.geometry)||void 0===t?void 0:t.type;"point"===i?A++:"polyline"===i?I++:(null==i?void 0:i.includes("polygon"))&&P++}));const T=new n.default({id:`dxf-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,visible:!0,opacity:1});T.addMany(R),h.view.map.add(T);const L=(e=>{const t=e.map((e=>{var t;return null===(t=e.geometry)||void 0===t?void 0:t.extent})).filter(Boolean);return E(t)})(R);return{id:T.id,name:e.name,color:t,layer:T,counts:{pts:A,lines:I,polys:P},extent:L,visible:!0,srcWKID:g.wkid}})),O=e=>v(this,void 0,void 0,(function*(){const t=Array.from(e).filter((e=>e&&e.name));if(!t.length)return;_({type:"info",msg:`Loading ${t.length} file(s)\u2026`});const i=A.length,n=[];for(let e=0;e<t.length;e++){const o=m[(i+e)%m.length],r=yield F(t[e],o);r&&n.push(r)}n.length&&(I((e=>[...e,...n])),_({type:"success",msg:`Loaded ${n.length} file(s).`}))})),z=e=>v(this,void 0,void 0,(function*(){(null==h?void 0:h.view)&&e.extent&&(yield h.view.goTo(e.extent.expand(1.2),{duration:0}))}));return(0,e.jsx)("div",{className:"p-3",css:{width:"100%"}},(0,e.jsx)("div",{className:"mb-2"},(0,e.jsx)(t.JimuMapViewComponent,{useMapWidgetId:D,onActiveViewChange:N})),(0,e.jsx)("div",{css:B.card},(0,e.jsx)("div",{css:{fontWeight:600,fontSize:14,marginBottom:8,borderBottom:"1px solid #e5e7eb",paddingBottom:4}},"DXF Uploader"),S&&(0,e.jsx)(i.Alert,{form:"basic",type:S.type,text:S.msg,withIcon:!0,className:"mb-2"}),(0,e.jsx)("div",{css:B.row,className:"mb-2"},(0,e.jsx)("div",null,(0,e.jsx)(i.Label,{className:"mr-1"},"Default File WKID"),(0,e.jsx)(i.TextInput,{size:"sm",style:{width:130},value:w,onChange:e=>j(e.target.value)})),(0,e.jsx)("div",null,(0,e.jsx)(i.Label,{className:"mr-1"},"Closed \u2192 Polygon"),(0,e.jsx)(i.Switch,{checked:k,onChange:(e,t)=>C(t)}))),(0,e.jsx)("div",{css:B.drop(M),onClick:()=>{var e;return null===(e=P.current)||void 0===e?void 0:e.click()},onDrop:e=>v(this,void 0,void 0,(function*(){var t;e.preventDefault(),R(!1),(null===(t=e.dataTransfer)||void 0===t?void 0:t.files)&&(yield O(e.dataTransfer.files))})),onDragOver:e=>{e.preventDefault(),R(!0)},onDragLeave:()=>R(!1)},(0,e.jsx)("div",{style:{fontWeight:600,marginBottom:4}},"Drag & drop DXFs here"),(0,e.jsx)("div",{style:{fontSize:12,color:"#475569"}},"\u2026or click to choose files"),(0,e.jsx)("input",{ref:P,multiple:!0,type:"file",accept:".dxf,.DXF",onChange:e=>v(this,void 0,void 0,(function*(){e.target.files&&(yield O(e.target.files)),e.target.value=""})),style:{display:"none"}})),(0,e.jsx)("div",{css:B.row,style:{marginTop:10}},(0,e.jsx)(i.Button,{size:"sm",onClick:()=>{var e;return null===(e=P.current)||void 0===e?void 0:e.click()}},"Choose DXFs"),(0,e.jsx)(i.Button,{size:"sm",type:"primary",onClick:()=>v(this,void 0,void 0,(function*(){if(!(null==h?void 0:h.view))return;const e=E(A.filter((e=>e.visible)).map((e=>e.extent)));e?yield h.view.goTo(e.expand(1.2),{duration:0}):_({type:"warning",msg:"Nothing visible to zoom to."})}))},"Zoom All"),(0,e.jsx)(i.Button,{size:"sm",type:"secondary",onClick:()=>{A.forEach((e=>{var t,i;try{null===(i=null===(t=null==h?void 0:h.view)||void 0===t?void 0:t.map)||void 0===i||i.remove(e.layer)}catch(e){}})),I([])}},"Clear All")),(0,e.jsx)("div",{css:B.list},A.map((t=>(0,e.jsx)("div",{key:t.id,css:B.item},(0,e.jsx)("div",{css:B.left},(0,e.jsx)("span",{css:B.dot(t.color)}),(0,e.jsx)("div",{style:{minWidth:0}},(0,e.jsx)("div",{className:"name"},t.name),(0,e.jsx)("div",{className:"meta"},"SRID:",t.srcWKID," \u2014 P:",t.counts.pts," L:",t.counts.lines," A:",t.counts.polys))),(0,e.jsx)("div",{css:B.right},(0,e.jsx)(i.Checkbox,{checked:t.visible,onChange:(e,i)=>((e,t)=>{var i,n;try{e.layer.visible=t,t&&(e.layer.opacity=1,null===(n=null===(i=null==h?void 0:h.view)||void 0===i?void 0:i.map)||void 0===n||n.reorder(e.layer,h.view.map.layers.length-1))}catch(e){}I((i=>i.map((i=>i.id===e.id?Object.assign(Object.assign({},i),{visible:t}):i))))})(t,i)}),(0,e.jsx)(i.Button,{size:"sm",onClick:()=>z(t)},"Zoom"),(0,e.jsx)(i.Button,{size:"sm",type:"secondary",onClick:()=>(e=>{var t,i;try{null===(i=null===(t=null==h?void 0:h.view)||void 0===t?void 0:t.map)||void 0===i||i.remove(e.layer)}catch(e){}I((t=>t.filter((t=>t.id!==e.id))))})(t)},"Remove"))))))))}function y(e,t,i,n){var a,d,u,c,p,f,v,m,g,y;if(!(null==e?void 0:e.type))return null;const x=String(e.type).toUpperCase();if("POINT"===x){const i=new r.default({x:null===(a=e.position)||void 0===a?void 0:a.x,y:null===(d=e.position)||void 0===d?void 0:d.y,spatialReference:t});return new o.default({geometry:i,symbol:n.point})}if("LINE"===x){const i=new s.default({spatialReference:t,paths:[[[null===(u=e.start)||void 0===u?void 0:u.x,null===(c=e.start)||void 0===c?void 0:c.y],[null===(p=e.end)||void 0===p?void 0:p.x,null===(f=e.end)||void 0===f?void 0:f.y]]]});return new o.default({geometry:i,symbol:n.line})}if("LWPOLYLINE"===x||"POLYLINE"===x){const r=(e.vertices||e.points||[]).map((e=>[e.x,e.y]));if(Boolean(e.closed||e.shape||r.length>2&&(h=r[0],j=r[r.length-1],!!h&&!!j&&Math.abs(h[0]-j[0])<1e-12&&Math.abs(h[1]-j[1])<1e-12))&&i){const e=new l.default({spatialReference:t,rings:[b(r)]});return new o.default({geometry:e,symbol:n.fill})}{const e=new s.default({spatialReference:t,paths:[r]});return new o.default({geometry:e,symbol:n.line})}}var h,j;if("CIRCLE"===x){const i=null===(v=e.center)||void 0===v?void 0:v.x,r=null===(m=e.center)||void 0===m?void 0:m.y,s=e.radius;if(isFinite(i)&&isFinite(r)&&isFinite(s)){const e=function(e,t,i,n=64){const o=[];for(let r=0;r<=n;r++){const s=r/n*2*Math.PI;o.push([e+i*Math.cos(s),t+i*Math.sin(s)])}return o}(i,r,s,96),a=new l.default({spatialReference:t,rings:[e]});return new o.default({geometry:a,symbol:n.fill})}}if("ARC"===x){const i=null===(g=e.center)||void 0===g?void 0:g.x,r=null===(y=e.center)||void 0===y?void 0:y.y,l=e.radius,a=w(e.startAngle),d=w(e.endAngle);if(isFinite(i)&&isFinite(r)&&isFinite(l)&&isFinite(a)&&isFinite(d)){const e=function(e,t,i,n,o,r=32){let s=o-n;s<0&&(s+=2*Math.PI);const l=[];for(let o=0;o<=r;o++){const a=n+s*o/r;l.push([e+i*Math.cos(a),t+i*Math.sin(a)])}return l}(i,r,l,a,d,64),u=new s.default({spatialReference:t,paths:[e]});return new o.default({geometry:u,symbol:n.line})}}if("TEXT"===x||"MTEXT"===x){const i=e.position||e.insertPoint;if(null!=(null==i?void 0:i.x)&&null!=(null==i?void 0:i.y)){const e=new r.default({x:i.x,y:i.y,spatialReference:t});return new o.default({geometry:e,symbol:n.point})}}return null}function b(e){if(!e.length)return e;const[t,i]=e[0],[n,o]=e[e.length-1];return Math.abs(t-n)<1e-12&&Math.abs(i-o)<1e-12?e:[...e,[t,i]]}function w(e){return e*Math.PI/180}function j(e){x.p=e}})(),h})())}}}));